# ç‰¹æœ‰ç§æ£€ç´¢åŠŸèƒ½ - å®Œæ•´å®ç°æ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ç‰¹æœ‰ç§æ£€ç´¢åŠŸèƒ½å…è®¸ç”¨æˆ·æŒ‰å›½å®¶æœç´¢è¯¥å›½ç‰¹æœ‰çš„é¸Ÿç±»ç‰©ç§ï¼Œå¿«é€Ÿäº†è§£å…¨çƒä¸åŒåœ°åŒºçš„ç‹¬ç‰¹é¸Ÿç±»èµ„æºï¼Œå¹¶æ”¯æŒæ‰¹é‡é€‰æ‹©é¸Ÿç§è¿›è¡Œè¿½è¸ªã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- **16ä¸ªå·²éªŒè¯å›½å®¶** - è¦†ç›–71.7%çš„ç‰¹æœ‰ç§æ•°æ®ï¼ˆ2,241/3,127ç§ï¼‰
- **3,127æ¡ç‰¹æœ‰ç§å…³ç³»** - å®Œæ•´çš„é¸Ÿç§åˆ°å›½å®¶çš„æ˜ å°„
- **æ™ºèƒ½æœç´¢** - æ”¯æŒä¸­è‹±æ–‡å›½å®¶åæœç´¢å’Œé¸Ÿç§åè¿‡æ»¤
- **æ‰¹é‡æ“ä½œ** - æ”¯æŒå…¨é€‰ã€æ¸…ç©ºã€æ‰¹é‡è¿½è¸ª
- **æ— ç¼é›†æˆ** - é€‰ä¸­çš„é¸Ÿç§å¯ç›´æ¥è·³è½¬åˆ°é¸Ÿè®¯è¿½è¸ªé¡µé¢

## ğŸ—‚ï¸ æ•°æ®ç»“æ„

### æ•°æ®åº“è¡¨ç»“æ„

#### 1. countriesï¼ˆå›½å®¶ä¿¡æ¯è¡¨ï¼‰
```sql
CREATE TABLE countries (
    country_id INTEGER PRIMARY KEY,
    country_name_en TEXT NOT NULL,      -- è‹±æ–‡åç§°
    country_name_cn TEXT,                -- ä¸­æ–‡åç§°
    iso_code TEXT,                       -- ISOå›½å®¶ä»£ç 
    region TEXT,                         -- æ‰€å±å¤§åŒº (Asia, Africaç­‰)
    endemic_count INTEGER DEFAULT 0,     -- ç‰¹æœ‰ç§æ•°é‡
    verified BOOLEAN DEFAULT 0           -- æ˜¯å¦å·²éªŒè¯
);
```

#### 2. endemic_birdsï¼ˆç‰¹æœ‰ç§å…³ç³»è¡¨ï¼‰
```sql
CREATE TABLE endemic_birds (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    bird_id INTEGER NOT NULL,
    country_id INTEGER NOT NULL,
    FOREIGN KEY (country_id) REFERENCES countries(country_id),
    UNIQUE(bird_id, country_id)
);
```

### æ•°æ®æ¥æº

- **endemic.json** - Bird ID Master APKæä¾›çš„ç‰¹æœ‰ç§æ˜ å°„ï¼ˆ3,127æ¡ï¼‰
- **birdinfo.json** - å®Œæ•´çš„é¸Ÿç§ä¿¡æ¯æ•°æ®åº“ï¼ˆ10,964ç§ï¼‰
- **country_mapping.json** - å›½å®¶IDåˆ°å›½å®¶åç§°çš„æ˜ å°„è¡¨

## ğŸ† å·²éªŒè¯å›½å®¶åˆ—è¡¨ï¼ˆæŒ‰ç‰¹æœ‰ç§æ•°é‡æ’åºï¼‰

| æ’å | å›½å®¶ï¼ˆä¸­æ–‡ï¼‰ | å›½å®¶ï¼ˆè‹±æ–‡ï¼‰ | ç‰¹æœ‰ç§æ•°é‡ | ISOä»£ç  | å¤§åŒº |
|------|------------|------------|----------|---------|------|
| 1 | å°åº¦å°¼è¥¿äºš | Indonesia | 462 | ID | Asia |
| 2 | æ¾³å¤§åˆ©äºš | Australia | 361 | AU | Oceania |
| 3 | ä¸­å›½ | China | 244 | CN | Asia |
| 4 | å·´å¸ƒäºšæ–°å‡ å†…äºš | Papua New Guinea | 225 | PG | Oceania |
| 5 | è²å¾‹å®¾ | Philippines | 125 | PH | Asia |
| 6 | ç§˜é² | Peru | 113 | PE | South America |
| 7 | æ–°è¥¿å…° | New Zealand | 108 | NZ | Oceania |
| 8 | å·´æ‹¿é©¬ | Panama | 97 | PA | Central America |
| 9 | æ³¢å…° | Poland | 86 | PL | Europe |
| 10 | å„ç“œå¤šå°” | Ecuador | 84 | EC | South America |
| 11 | å°åº¦ | India | 78 | IN | Asia |
| 12 | å¦æ¡‘å°¼äºš | Tanzania | 76 | TZ | Africa |
| 13 | æ‰€ç½—é—¨ç¾¤å²› | Solomon Islands | 72 | SB | Oceania |
| 14 | åˆšæœæ°‘ä¸»å…±å’Œå›½ | Democratic Republic of the Congo | 70 | CD | Africa |
| 15 | æ–æµ | Fiji | 39 | FJ | Oceania |
| 16 | è‹±å›½ | United Kingdom | 1 | GB | Europe |

## ğŸ”§ æŠ€æœ¯å®ç°

### åç«¯APIç«¯ç‚¹

#### 1. GET `/api/countries`
è·å–æ‰€æœ‰å·²éªŒè¯å›½å®¶åˆ—è¡¨

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "countries": [
    {
      "country_id": 105,
      "country_name_cn": "å°åº¦å°¼è¥¿äºš",
      "country_name_en": "Indonesia",
      "endemic_count": 462,
      "region": "Asia"
    }
  ],
  "total": 16
}
```

#### 2. GET `/api/endemic-birds/<country_name>`
è·å–æŸä¸ªå›½å®¶çš„ç‰¹æœ‰é¸Ÿç§åˆ—è¡¨ï¼ˆæ”¯æŒä¸­è‹±æ–‡æœç´¢ï¼‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "country": {
    "country_id": 30,
    "country_name_cn": "ä¸­å›½",
    "country_name_en": "China",
    "endemic_count": 244,
    "verified": true
  },
  "birds": [
    {
      "bird_id": 31,
      "cn_name": "çº¢è„šç©´ä³",
      "en_name": "Red-legged Tinamou",
      "sci_name": "Crypturellus erythropus"
    }
  ],
  "total_species": 244
}
```

### å‰ç«¯é¡µé¢

#### `/endemic` - ç‰¹æœ‰ç§æ£€ç´¢é¡µé¢
- **å›½å®¶é€‰æ‹©åŒº** - ç½‘æ ¼å¸ƒå±€å±•ç¤ºæ‰€æœ‰å›½å®¶ï¼Œæ”¯æŒå®æ—¶æœç´¢è¿‡æ»¤
- **ç»Ÿè®¡ä¿¡æ¯** - æ˜¾ç¤ºç‰¹æœ‰ç§æ•°é‡æ’è¡Œæ¦œTOP 5
- **é¸Ÿç§åˆ—è¡¨** - å‹¾é€‰æ¡†+æœç´¢è¿‡æ»¤ï¼Œæ”¯æŒæ‰¹é‡é€‰æ‹©
- **æ“ä½œæŒ‰é’®** - å…¨é€‰ã€æ¸…ç©ºã€è¿½è¸ªå·²é€‰é¸Ÿç§

#### ç”¨æˆ·æµç¨‹
1. è®¿é—® `/endemic` é¡µé¢
2. æœç´¢æˆ–ç›´æ¥ç‚¹å‡»ç›®æ ‡å›½å®¶
3. æŸ¥çœ‹è¯¥å›½ç‰¹æœ‰é¸Ÿç§åˆ—è¡¨
4. ä½¿ç”¨æœç´¢æ¡†è¿‡æ»¤é¸Ÿç§ï¼ˆæ”¯æŒä¸­è‹±æ–‡ï¼‰
5. å‹¾é€‰æ„Ÿå…´è¶£çš„é¸Ÿç§
6. ç‚¹å‡»"è¿½è¸ªå·²é€‰é¸Ÿç§"è·³è½¬åˆ° `/tracker` é¡µé¢
7. åœ¨trackeré¡µé¢è‡ªåŠ¨åŠ è½½é€‰ä¸­çš„é¸Ÿç§

## ğŸ“‚ æ–‡ä»¶æ¸…å•

### è„šæœ¬æ–‡ä»¶
- `scripts/country_mapper.py` - å›½å®¶IDæ˜ å°„å·¥å…·
- `scripts/init_endemic_database.py` - æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
- `scripts/test_endemic_query.py` - åŠŸèƒ½æµ‹è¯•è„šæœ¬

### æ•°æ®æ–‡ä»¶
- `data/country_mapping.json` - å›½å®¶IDåˆ°åç§°çš„æ˜ å°„è¡¨
- `data/ebird_reference.sqlite` - SQLiteæ•°æ®åº“ï¼ˆæ–°å¢countrieså’Œendemic_birdsè¡¨ï¼‰

### æ¨¡æ¿æ–‡ä»¶
- `src/templates/endemic.html` - ç‰¹æœ‰ç§æ£€ç´¢é¡µé¢
- `src/templates/base.html` - å¯¼èˆªæ å·²æ·»åŠ ç‰¹æœ‰ç§å…¥å£
- `src/templates/index.html` - é¦–é¡µå·²æ·»åŠ ç‰¹æœ‰ç§åŠŸèƒ½å¡ç‰‡

### ä»£ç ä¿®æ”¹
- `src/web_app.py` - æ–°å¢è·¯ç”±å’ŒAPIç«¯ç‚¹
  - `@app.route('/endemic')` - ç‰¹æœ‰ç§é¡µé¢è·¯ç”±ï¼ˆç¬¬481è¡Œï¼‰
  - `@app.route('/api/countries')` - å›½å®¶åˆ—è¡¨APIï¼ˆç¬¬1995è¡Œï¼‰
  - `@app.route('/api/endemic-birds/<country_name>')` - ç‰¹æœ‰ç§æŸ¥è¯¢APIï¼ˆç¬¬2040è¡Œï¼‰

## ğŸš€ éƒ¨ç½²æŒ‡å—

### 1. åˆå§‹åŒ–æ•°æ®åº“

```bash
# è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
python3 scripts/init_endemic_database.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
ğŸš€ å¼€å§‹åˆå§‹åŒ–ç‰¹æœ‰é¸Ÿç§æ•°æ®åº“...
âœ… è¡¨ç»“æ„åˆ›å»ºæˆåŠŸ
âœ… å·²å¯¼å…¥ 104 ä¸ªå›½å®¶
âœ… å·²å¯¼å…¥ 3127 æ¡ç‰¹æœ‰ç§å…³ç³»

======================================================================
ğŸ“Š æ•°æ®å¯¼å…¥éªŒè¯ç»“æœ
======================================================================
æ€»å›½å®¶æ•°: 104
å·²éªŒè¯å›½å®¶: 16 (15.4%)
ç‰¹æœ‰ç§å…³ç³»æ•°: 3127
æ€»ç‰¹æœ‰ç§æ•°: 3127

ğŸ† ç‰¹æœ‰ç§æœ€å¤šçš„å‰10ä¸ªå›½å®¶:
...
âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼
ğŸ“ æ•°æ®åº“ä½ç½®: /Users/.../data/ebird_reference.sqlite
```

### 2. å¯åŠ¨WebæœåŠ¡

```bash
python3 src/web_app.py
```

### 3. è®¿é—®åŠŸèƒ½

åœ¨æµè§ˆå™¨æ‰“å¼€ï¼š
- ç‰¹æœ‰ç§æ£€ç´¢é¡µé¢ï¼šhttp://127.0.0.1:5001/endemic
- APIæµ‹è¯•ï¼š
  ```bash
  curl http://127.0.0.1:5001/api/countries
  curl http://127.0.0.1:5001/api/endemic-birds/ä¸­å›½
  ```

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

### APIæµ‹è¯•
```bash
# æµ‹è¯•å›½å®¶åˆ—è¡¨
curl -s http://127.0.0.1:5001/api/countries | python3 -m json.tool

# æµ‹è¯•ç‰¹æœ‰ç§æŸ¥è¯¢ï¼ˆä¸­æ–‡ï¼‰
curl -s http://127.0.0.1:5001/api/endemic-birds/ä¸­å›½ | python3 -m json.tool

# æµ‹è¯•ç‰¹æœ‰ç§æŸ¥è¯¢ï¼ˆè‹±æ–‡ï¼‰
curl -s http://127.0.0.1:5001/api/endemic-birds/Australia | python3 -m json.tool
```

### äº¤äº’å¼æµ‹è¯•
```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
python3 scripts/test_endemic_query.py
```

## ğŸ“Š æ•°æ®ç»Ÿè®¡

- **æ•°æ®åº“å¤§å°ï¼š** çº¦2MB
- **APIå“åº”æ—¶é—´ï¼š** <100msï¼ˆæœ¬åœ°ï¼‰
- **å·²éªŒè¯è¦†ç›–ç‡ï¼š** 71.7%çš„ç‰¹æœ‰ç§æ•°æ®
- **å‰ç«¯æ€§èƒ½ï¼š**
  - å›½å®¶åˆ—è¡¨æ¸²æŸ“ï¼š16ä¸ªå›½å®¶ï¼Œ<50ms
  - é¸Ÿç§åˆ—è¡¨æ¸²æŸ“ï¼šæœ€å¤š462ç§ï¼ˆå°å°¼ï¼‰ï¼Œ<200ms
  - æœç´¢è¿‡æ»¤å“åº”ï¼šå®æ—¶ï¼ˆ<10msï¼‰

## ğŸ”® æœªæ¥æ”¹è¿›æ–¹å‘

### æ•°æ®å®Œæ•´æ€§
- [ ] è¡¥å……å‰©ä½™88ä¸ªæœªéªŒè¯å›½å®¶çš„åç§°æ˜ å°„
- [ ] ä½¿ç”¨eBird APIè¿›è¡Œè‡ªåŠ¨å›½å®¶åç§°æŸ¥è¯¢
- [ ] æ·»åŠ å›½å®¶çš„ISOä»£ç å’Œåœ°ç†åŒºåŸŸä¿¡æ¯

### åŠŸèƒ½å¢å¼º
- [ ] æ·»åŠ ç‰¹æœ‰ç§ç…§ç‰‡å±•ç¤º
- [ ] æ”¯æŒæŒ‰å¤§åŒºï¼ˆäºšæ´²ã€éæ´²ç­‰ï¼‰ç­›é€‰å›½å®¶
- [ ] æ˜¾ç¤ºç‰¹æœ‰ç§çš„æ¿’å±çŠ¶æ€ï¼ˆIUCNç­‰çº§ï¼‰
- [ ] æ·»åŠ ç‰¹æœ‰ç§åˆ†å¸ƒåœ°å›¾å¯è§†åŒ–
- [ ] æ”¯æŒå¯¼å‡ºç‰¹æœ‰ç§æ¸…å•ä¸ºPDF/Excel

### æ€§èƒ½ä¼˜åŒ–
- [ ] æ·»åŠ Redisç¼“å­˜åŠ é€ŸæŸ¥è¯¢
- [ ] å®ç°æ‡’åŠ è½½ä¼˜åŒ–å¤§é‡é¸Ÿç§çš„æ¸²æŸ“
- [ ] æ·»åŠ åˆ†é¡µåŠŸèƒ½å¤„ç†è¶…è¿‡500ç§çš„å›½å®¶

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯1ï¼šæŸ¥æ‰¾ä¸­å›½ç‰¹æœ‰é¸Ÿç§
1. è®¿é—® `/endemic` é¡µé¢
2. åœ¨æœç´¢æ¡†è¾“å…¥"ä¸­å›½"æˆ–"China"
3. ç‚¹å‡»ä¸­å›½å¡ç‰‡
4. æµè§ˆ244ç§ä¸­å›½ç‰¹æœ‰é¸Ÿ
5. å‹¾é€‰æ„Ÿå…´è¶£çš„é¸Ÿç§ï¼ˆå¦‚ï¼šè¤é©¬é¸¡ã€ç™½é©¬é¸¡ï¼‰
6. ç‚¹å‡»"è¿½è¸ªå·²é€‰é¸Ÿç§"
7. è‡ªåŠ¨è·³è½¬åˆ°trackeré¡µé¢å¹¶åŠ è½½è¿™äº›é¸Ÿç§çš„è§‚æµ‹æ•°æ®

### åœºæ™¯2ï¼šæ¢ç´¢æ¾³å¤§åˆ©äºšç‰¹æœ‰é¸Ÿ
1. åœ¨å›½å®¶åˆ—è¡¨ä¸­æ‰¾åˆ°"æ¾³å¤§åˆ©äºš"ï¼ˆæ’åç¬¬2ï¼Œ361ç§ï¼‰
2. ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†åˆ—è¡¨
3. ä½¿ç”¨é¸Ÿåæœç´¢æ¡†è¾“å…¥"Cockatoo"
4. å¿«é€Ÿæ‰¾åˆ°æ¾³æ´²ç‰¹æœ‰çš„å„ç§å‡¤å¤´é¹¦é¹‰
5. æ‰¹é‡é€‰æ‹©å¹¶è¿½è¸ª

## ğŸ“ å¼€å‘æ³¨æ„äº‹é¡¹

### æ•°æ®è·¯å¾„ä¾èµ–
å½“å‰å®ç°ä¸­ï¼Œbirdinfo.jsonçš„è·¯å¾„æ˜¯ç¡¬ç¼–ç çš„ï¼š
```python
birdinfo_path = "/Users/jameszhenyu/Pictures/Flickr Photo/Bird ID Master_0.0.10_APKPure/assets/flutter_assets/data/birdinfo.json"
```

**å»ºè®®æ”¹è¿›ï¼š**
```python
# ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶
BIRDINFO_PATH = os.environ.get('BIRDINFO_PATH',
    '/path/to/default/birdinfo.json')
```

### æ•°æ®åº“ä½ç½®
æ•°æ®åº“æ–‡ä»¶ä¿å­˜åœ¨ `data/ebird_reference.sqlite`ï¼Œå»ºè®®æ·»åŠ åˆ° `.gitignore`ï¼š
```gitignore
data/ebird_reference.sqlite
data/country_mapping.json
```

## ğŸ¯ æ€»ç»“

ç‰¹æœ‰ç§æ£€ç´¢åŠŸèƒ½å·²å®Œå…¨å®ç°å¹¶é€šè¿‡æµ‹è¯•ï¼Œæä¾›äº†ï¼š
- âœ… å®Œæ•´çš„æ•°æ®åº“æ¶æ„å’Œæ•°æ®å¯¼å…¥
- âœ… RESTful APIç«¯ç‚¹
- âœ… ç°ä»£åŒ–çš„å‰ç«¯ç•Œé¢
- âœ… ä¸ç°æœ‰é¸Ÿè®¯è¿½è¸ªåŠŸèƒ½çš„æ— ç¼é›†æˆ
- âœ… è¯¦ç»†çš„æ–‡æ¡£å’Œæµ‹è¯•è„šæœ¬

ç”¨æˆ·ç°åœ¨å¯ä»¥æ–¹ä¾¿åœ°æ¢ç´¢å…¨çƒå„å›½çš„ç‰¹æœ‰é¸Ÿç§ï¼Œå¹¶å¿«é€Ÿå¼€å§‹è¿½è¸ªè§‚æµ‹ã€‚
