{% extends "base.html" %}

{% block title %}è·¯çº¿çƒ­ç‚¹ - æ…§çœ¼æ‰¾é¸Ÿ{% endblock %}

{% block extra_head %}
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
{% endblock %}

{% block content %}
<div class="route-container">
    <h1 class="page-title">
        <i class="bi bi-map"></i> è·¯çº¿çƒ­ç‚¹æœç´¢
    </h1>
    <p class="subtitle">è§„åˆ’æ‚¨çš„è§‚é¸Ÿè·¯çº¿ï¼Œå‘ç°æ²¿é€”çš„ eBird çƒ­ç‚¹</p>

    <div class="route-form">
        <div class="form-group">
            <label for="startLocation">
                <i class="bi bi-geo-alt-fill text-success"></i> èµ·ç‚¹
            </label>
            <div class="input-with-button">
                <input type="text" id="startLocation" placeholder="ä¾‹å¦‚: Darwin, NT æˆ– -12.4634,130.8456" class="form-input">
                <button onclick="verifyStartLocation()" class="btn-icon" title="éªŒè¯åœ°å€">
                    <i class="bi bi-search"></i>
                </button>
            </div>
            <small id="startVerified" class="verified-info"></small>
        </div>

        <div class="form-group">
            <label for="endLocation">
                <i class="bi bi-geo-alt-fill text-danger"></i> ç»ˆç‚¹
            </label>
            <div class="input-with-button">
                <input type="text" id="endLocation" placeholder="ä¾‹å¦‚: Katherine, NT æˆ– -14.4648,132.2648" class="form-input">
                <button onclick="verifyEndLocation()" class="btn-icon" title="éªŒè¯åœ°å€">
                    <i class="bi bi-search"></i>
                </button>
            </div>
            <small id="endVerified" class="verified-info"></small>
        </div>

        <div class="form-group">
            <label for="searchRadius">
                <i class="bi bi-circle"></i> æœç´¢åŠå¾„ (å…¬é‡Œ)
            </label>
            <input type="number" id="searchRadius" value="5" min="1" max="50" class="form-input">
            <small class="form-hint">æ²¿è·¯çº¿æœç´¢çƒ­ç‚¹çš„åŠå¾„èŒƒå›´</small>
        </div>

        <div class="form-group">
            <label for="daysBack">
                <i class="bi bi-calendar"></i> æ—¶é—´èŒƒå›´ (å¤©)
            </label>
            <input type="number" id="daysBack" value="14" min="1" max="30" class="form-input">
            <small class="form-hint">ä»…æ˜¾ç¤ºæœ€è¿‘Nå¤©æœ‰è§‚æµ‹è®°å½•çš„çƒ­ç‚¹</small>
        </div>

        <button onclick="searchRouteHotspots()" class="btn btn-primary btn-large">
            <i class="bi bi-search"></i> æœç´¢è·¯çº¿çƒ­ç‚¹
        </button>
    </div>

    <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
    <div id="resultsContainer" class="results-section" style="display: none;">
        <h2 class="section-title">
            <i class="bi bi-map-fill"></i> è·¯çº¿åœ°å›¾
        </h2>

        <!-- åœ°å›¾å®¹å™¨ -->
        <div id="mapContainer" class="map-container">
            <div id="map"></div>
        </div>

        <div id="routeInfo" class="route-info"></div>

        <h2 class="section-title">
            <i class="bi bi-pin-map-fill"></i> æ²¿é€”çƒ­ç‚¹åˆ—è¡¨
        </h2>
        <div id="hotspotsList" class="hotspots-list"></div>
    </div>
</div>

<style>
.route-container {
    max-width: 900px;
    margin: 0 auto;
}

.page-title {
    font-size: 2.5rem;
    color: var(--primary-color);
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.5rem;
}

.subtitle {
    color: var(--text-light);
    font-size: 1.1rem;
    margin-bottom: 2rem;
}

.route-form {
    background: var(--card-bg);
    padding: 2rem;
    border-radius: 12px;
    box-shadow: var(--shadow-sm);
    margin-bottom: 2rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-dark);
}

.form-input {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s;
}

.form-input:focus {
    outline: none;
    border-color: var(--primary-color);
}

.input-with-button {
    display: flex;
    gap: 0.5rem;
}

.input-with-button input {
    flex: 1;
}

.btn-icon {
    padding: 0.75rem 1rem;
    background: var(--secondary-color);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s;
}

.btn-icon:hover {
    background: var(--secondary-dark);
}

.verified-info {
    display: block;
    margin-top: 0.5rem;
    color: var(--success-color);
    font-size: 0.9rem;
}

.form-hint {
    display: block;
    margin-top: 0.3rem;
    color: var(--text-light);
    font-size: 0.85rem;
}

.btn-large {
    width: 100%;
    padding: 1rem;
    font-size: 1.1rem;
    margin-top: 1rem;
}

.results-section {
    animation: fadeIn 0.5s;
}

.section-title {
    font-size: 1.8rem;
    color: var(--primary-color);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.map-container {
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: var(--shadow-md);
    overflow: hidden;
    margin-bottom: 2rem;
}

#map {
    width: 100%;
    height: 500px;
}

.route-info {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: var(--shadow-sm);
    margin-bottom: 1.5rem;
}

.hotspots-list {
    display: grid;
    gap: 1rem;
}

.hotspot-card {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: var(--shadow-sm);
    border-left: 4px solid var(--primary-color);
    transition: transform 0.3s, box-shadow 0.3s;
}

.hotspot-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.hotspot-name {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.hotspot-meta {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    margin-top: 0.5rem;
    color: var(--text-light);
    font-size: 0.9rem;
}

.hotspot-meta span {
    display: flex;
    align-items: center;
    gap: 0.3rem;
}

.text-success {
    color: var(--success-color);
}

.text-danger {
    color: #e74c3c;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
let startCoords = null;
let endCoords = null;
let map = null;
let routeLayer = null;
let markersLayer = null;

async function verifyStartLocation() {
    const location = document.getElementById('startLocation').value.trim();
    if (!location) {
        showNotification('è¯·è¾“å…¥èµ·ç‚¹ä½ç½®', 'error');
        return;
    }

    const coords = await verifyLocation(location, 'startVerified');
    if (coords) {
        startCoords = coords;
    }
}

async function verifyEndLocation() {
    const location = document.getElementById('endLocation').value.trim();
    if (!location) {
        showNotification('è¯·è¾“å…¥ç»ˆç‚¹ä½ç½®', 'error');
        return;
    }

    const coords = await verifyLocation(location, 'endVerified');
    if (coords) {
        endCoords = coords;
    }
}

async function verifyLocation(location, displayId) {
    try {
        // æ£€æŸ¥æ˜¯å¦æ˜¯GPSåæ ‡æ ¼å¼
        const coordMatch = location.match(/^(-?\d+\.?\d*),\s*(-?\d+\.?\d*)$/);
        if (coordMatch) {
            const lat = parseFloat(coordMatch[1]);
            const lng = parseFloat(coordMatch[2]);
            document.getElementById(displayId).innerHTML =
                `<i class="bi bi-check-circle-fill"></i> GPS: ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
            return { lat, lng };
        }

        // å¦åˆ™è¿›è¡Œåœ°å€è§£æ
        const data = await apiRequest('/api/geocode', {
            method: 'POST',
            body: JSON.stringify({ place_name: location })
        });

        if (data.success) {
            document.getElementById(displayId).innerHTML =
                `<i class="bi bi-check-circle-fill"></i> ${data.display_name}<br>GPS: ${data.latitude.toFixed(4)}, ${data.longitude.toFixed(4)}`;
            return { lat: data.latitude, lng: data.longitude };
        }
    } catch (error) {
        // Error already handled by apiRequest
        return null;
    }
}

async function searchRouteHotspots() {
    const startLocation = document.getElementById('startLocation').value.trim();
    const endLocation = document.getElementById('endLocation').value.trim();
    const searchRadius = parseInt(document.getElementById('searchRadius').value);
    const daysBack = parseInt(document.getElementById('daysBack').value);

    if (!startLocation || !endLocation) {
        showNotification('è¯·è¾“å…¥èµ·ç‚¹å’Œç»ˆç‚¹', 'error');
        return;
    }

    // å¦‚æœè¿˜æ²¡éªŒè¯åæ ‡ï¼Œå…ˆéªŒè¯
    if (!startCoords) {
        startCoords = await verifyLocation(startLocation, 'startVerified');
    }
    if (!endCoords) {
        endCoords = await verifyLocation(endLocation, 'endVerified');
    }

    if (!startCoords || !endCoords) {
        showNotification('åœ°å€éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥', 'error');
        return;
    }

    try {
        // ç¦ç”¨æœç´¢æŒ‰é’®
        const searchBtn = document.querySelector('.btn-primary');
        const originalBtnText = searchBtn.innerHTML;
        searchBtn.disabled = true;
        searchBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> æœç´¢ä¸­...';

        // æ˜¾ç¤ºè¯¦ç»†çš„åŠ è½½ä¿¡æ¯
        showNotification('ğŸ—ºï¸ æ­£åœ¨è§„åˆ’é©¾è½¦è·¯çº¿...', 'info');

        const data = await apiRequest('/api/route-hotspots', {
            method: 'POST',
            body: JSON.stringify({
                start_lat: startCoords.lat,
                start_lng: startCoords.lng,
                end_lat: endCoords.lat,
                end_lng: endCoords.lng,
                search_radius: searchRadius,
                days_back: daysBack
            })
        });

        // æ¢å¤æŒ‰é’®
        searchBtn.disabled = false;
        searchBtn.innerHTML = originalBtnText;

        if (data.success) {
            showNotification(`âœ“ æ‰¾åˆ° ${data.hotspots_count} ä¸ªè§‚é¸Ÿçƒ­ç‚¹ï¼`, 'success');
            displayResults(data);
        }
    } catch (error) {
        // æ¢å¤æŒ‰é’®
        const searchBtn = document.querySelector('.btn-primary');
        searchBtn.disabled = false;
        searchBtn.innerHTML = '<i class="bi bi-search"></i> æœç´¢è·¯çº¿çƒ­ç‚¹';
        // Error already handled by apiRequest
    }
}

function initMap() {
    if (!map) {
        map = L.map('map').setView([-25.2744, 133.7751], 5); // æ¾³å¤§åˆ©äºšä¸­å¿ƒ

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 18
        }).addTo(map);
    }

    // æ¸…é™¤ä¹‹å‰çš„å›¾å±‚
    if (routeLayer) {
        map.removeLayer(routeLayer);
    }
    if (markersLayer) {
        map.removeLayer(markersLayer);
    }
}

function displayResults(data) {
    const resultsContainer = document.getElementById('resultsContainer');
    const routeInfo = document.getElementById('routeInfo');
    const hotspotsList = document.getElementById('hotspotsList');

    // åˆå§‹åŒ–åœ°å›¾
    resultsContainer.style.display = 'block';
    setTimeout(() => {
        initMap();

        // æ˜¾ç¤ºé©¾è½¦è·¯çº¿ï¼ˆä½¿ç”¨APIè¿”å›çš„çœŸå®è·¯çº¿åæ ‡ï¼‰
        const routeCoords = data.route_coords || [
            [startCoords.lat, startCoords.lng],
            [endCoords.lat, endCoords.lng]
        ];

        routeLayer = L.polyline(routeCoords, {
            color: '#3498db',
            weight: 5,
            opacity: 0.8
        }).addTo(map);

        // æ·»åŠ èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è®°
        const startIcon = L.divIcon({
            className: 'custom-marker',
            html: '<div style="background: #27ae60; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">èµ·</div>',
            iconSize: [30, 30]
        });

        const endIcon = L.divIcon({
            className: 'custom-marker',
            html: '<div style="background: #e74c3c; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">ç»ˆ</div>',
            iconSize: [30, 30]
        });

        L.marker([startCoords.lat, startCoords.lng], {icon: startIcon})
            .addTo(map)
            .bindPopup(`<b>èµ·ç‚¹</b><br>${data.start_location || 'GPSåæ ‡'}`);

        L.marker([endCoords.lat, endCoords.lng], {icon: endIcon})
            .addTo(map)
            .bindPopup(`<b>ç»ˆç‚¹</b><br>${data.end_location || 'GPSåæ ‡'}`);

        // æ·»åŠ çƒ­ç‚¹æ ‡è®°
        if (data.hotspots && data.hotspots.length > 0) {
            const hotspotIcon = L.divIcon({
                className: 'custom-marker',
                html: '<div style="background: #f39c12; color: white; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">ğŸ“</div>',
                iconSize: [25, 25]
            });

            data.hotspots.forEach((hotspot, index) => {
                L.marker([hotspot.lat, hotspot.lng], {icon: hotspotIcon})
                    .addTo(map)
                    .bindPopup(`
                        <b>${hotspot.locName}</b><br>
                        <small>ç‰©ç§æ•°: ${hotspot.numSpeciesAllTime || 'N/A'}<br>
                        æœ€è¿‘è§‚æµ‹: ${hotspot.latestObsDt || 'æœªçŸ¥'}</small><br>
                        <a href="https://ebird.org/hotspot/${hotspot.locId}" target="_blank">eBirdé¡µé¢</a>
                    `);
            });
        }

        // è°ƒæ•´åœ°å›¾è§†é‡ä»¥åŒ…å«æ‰€æœ‰æ ‡è®°
        const bounds = L.latLngBounds(routeCoords);
        if (data.hotspots && data.hotspots.length > 0) {
            data.hotspots.forEach(h => {
                bounds.extend([h.lat, h.lng]);
            });
        }
        map.fitBounds(bounds, {padding: [50, 50]});
    }, 100);

    // æ˜¾ç¤ºè·¯çº¿ä¿¡æ¯
    routeInfo.innerHTML = `
        <h3><i class="bi bi-info-circle-fill"></i> è·¯çº¿ä¿¡æ¯</h3>
        <p><strong>èµ·ç‚¹:</strong> ${data.start_location || 'GPSåæ ‡'}</p>
        <p><strong>ç»ˆç‚¹:</strong> ${data.end_location || 'GPSåæ ‡'}</p>
        <p><strong>é©¾è½¦è·ç¦»:</strong> ${data.route_distance_km} km</p>
        <p><strong>æœç´¢åŠå¾„:</strong> ${data.search_radius} kmï¼ˆæ²¿è·¯çº¿ä¸¤ä¾§ï¼‰</p>
        <p><strong>é‡‡æ ·ç‚¹æ•°:</strong> ${data.sample_points_count} ä¸ª</p>
        <p><strong>æ‰¾åˆ°çƒ­ç‚¹:</strong> ${data.hotspots_count} ä¸ª</p>
    `;

    // æ˜¾ç¤ºçƒ­ç‚¹åˆ—è¡¨
    if (data.hotspots && data.hotspots.length > 0) {
        hotspotsList.innerHTML = data.hotspots.map((hotspot, index) => `
            <div class="hotspot-card">
                <div class="hotspot-name">
                    ${index + 1}. ${hotspot.locName}
                </div>
                <div class="hotspot-meta">
                    <span><i class="bi bi-geo-alt-fill"></i> ${hotspot.lat.toFixed(4)}, ${hotspot.lng.toFixed(4)}</span>
                    <span><i class="bi bi-calendar"></i> æœ€è¿‘è§‚æµ‹: ${hotspot.latestObsDt || 'æœªçŸ¥'}</span>
                    <span><i class="bi bi-eye-fill"></i> è§‚æµ‹ç‰©ç§æ•°: ${hotspot.numSpeciesAllTime || 'N/A'}</span>
                </div>
                <div style="margin-top: 0.8rem;">
                    <button onclick="viewHotspotDetails('${hotspot.locId}', '${hotspot.locName.replace(/'/g, "\\'")}', ${hotspot.lat}, ${hotspot.lng})" class="btn btn-primary btn-sm">
                        <i class="bi bi-binoculars-fill"></i> æŸ¥çœ‹è§‚æµ‹è®°å½•
                    </button>
                    <a href="https://maps.google.com/?q=${hotspot.lat},${hotspot.lng}" target="_blank" class="btn btn-secondary btn-sm">
                        <i class="bi bi-map"></i> åœ°å›¾
                    </a>
                    <a href="https://ebird.org/hotspot/${hotspot.locId}" target="_blank" class="btn btn-secondary btn-sm">
                        <i class="bi bi-link-45deg"></i> eBird
                    </a>
                </div>
            </div>
        `).join('');
    } else {
        hotspotsList.innerHTML = '<p class="no-results">æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„çƒ­ç‚¹</p>';
    }

    resultsContainer.style.display = 'block';
    resultsContainer.scrollIntoView({ behavior: 'smooth' });
}

// æŸ¥çœ‹çƒ­ç‚¹è¯¦æƒ…
async function viewHotspotDetails(locId, locName, lat, lng) {
    const modal = document.getElementById('hotspotModal');
    const modalBody = document.getElementById('hotspotModalBody');
    const modalTitle = document.getElementById('hotspotModalTitle');

    // æ˜¾ç¤ºæ¨¡æ€æ¡†
    modal.style.display = 'block';
    modalTitle.innerHTML = `<i class="bi bi-binoculars-fill"></i> ${locName}`;
    modalBody.innerHTML = '<div class="loading-spinner"><i class="bi bi-hourglass-split"></i> åŠ è½½ä¸­...</div>';

    try {
        // ä½¿ç”¨çƒ­ç‚¹IDè·å–è¯¥çƒ­ç‚¹çš„è§‚æµ‹è®°å½•
        const data = await apiRequest(`/api/hotspot-observations/${locId}?days=14`);

        if (data.success && data.observations) {
            let html = `
                <div class="hotspot-info">
                    <p><strong><i class="bi bi-geo-alt-fill"></i> çƒ­ç‚¹ID:</strong> ${locId}</p>
                    <p><strong><i class="bi bi-binoculars-fill"></i> æœ€è¿‘14å¤©è§‚æµ‹:</strong> ${data.total_species} ä¸ªç‰©ç§</p>
                    <p><a href="https://ebird.org/hotspot/${locId}" target="_blank"><i class="bi bi-link-45deg"></i> åœ¨ eBird æŸ¥çœ‹å®Œæ•´ä¿¡æ¯</a></p>
                </div>

                <h3><i class="bi bi-list-ul"></i> é¸Ÿç§åå½• (${data.total_species} ç§)</h3>
                <div class="species-list">
            `;

            data.observations.forEach((obs, index) => {
                const obsDate = obs.obsDt || 'æœªçŸ¥æ—¶é—´';
                const count = obs.howMany || 'X';
                const displayName = obs.cnName || obs.comName;  // ä¼˜å…ˆæ˜¾ç¤ºä¸­æ–‡å
                html += `
                    <div class="species-item">
                        <div class="species-name">
                            <div class="cn">${index + 1}. <a href="javascript:void(0)" class="bird-name-link" onclick="showBirdInfo('${displayName}')">${displayName}</a></div>
                            <div class="en">${obs.comName}</div>
                        </div>
                        <div class="species-count">${count} åª</div>
                    </div>
                `;
            });

            html += '</div>';
            modalBody.innerHTML = html;
        } else {
            modalBody.innerHTML = '<div class="error-message"><i class="bi bi-exclamation-triangle"></i> æœªæ‰¾åˆ°è§‚æµ‹è®°å½•</div>';
        }
    } catch (error) {
        modalBody.innerHTML = '<div class="error-message"><i class="bi bi-exclamation-triangle"></i> åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
    }
}

function closeHotspotModal() {
    document.getElementById('hotspotModal').style.display = 'none';
}

// ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
window.onclick = function(event) {
    const modal = document.getElementById('hotspotModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}
</script>

<!-- çƒ­ç‚¹è¯¦æƒ…æ¨¡æ€æ¡† -->
<div id="hotspotModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="hotspotModalTitle"></h2>
            <span class="close" onclick="closeHotspotModal()">&times;</span>
        </div>
        <div class="modal-body" id="hotspotModalBody">
            <div class="loading-spinner">åŠ è½½ä¸­...</div>
        </div>
    </div>
</div>

<style>
/* å¤ç”¨result.htmlçš„æ¨¡æ€æ¡†æ ·å¼ */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.6);
    animation: fadeIn 0.3s;
}

.modal-content {
    background-color: var(--card-bg);
    margin: 5% auto;
    padding: 0;
    border-radius: 12px;
    max-width: 800px;
    max-height: 80vh;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    animation: slideDown 0.3s;
}

.modal-header {
    background: var(--primary-color);
    color: white;
    padding: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    margin: 0;
    font-size: 1.5rem;
}

.close {
    color: white;
    font-size: 2rem;
    font-weight: bold;
    cursor: pointer;
    line-height: 1;
}

.close:hover {
    opacity: 0.8;
}

.modal-body {
    padding: 2rem;
    max-height: 60vh;
    overflow-y: auto;
}

.hotspot-info {
    background: var(--bg-color);
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
}

.hotspot-info p {
    margin: 0.5rem 0;
}

.species-list {
    display: grid;
    gap: 0.8rem;
}

.species-item {
    background: var(--bg-color);
    padding: 1rem;
    border-radius: 8px;
    border-left: 4px solid var(--primary-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.species-name {
    flex: 1;
}

.species-name .cn {
    font-weight: 600;
    font-size: 1.1rem;
    color: var(--text-dark);
}

.species-name .en {
    font-size: 0.9rem;
    color: var(--text-light);
    margin-top: 0.2rem;
}

.species-count {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--primary-color);
    min-width: 50px;
    text-align: right;
}

@keyframes slideDown {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}
</style>

{% endblock %}
